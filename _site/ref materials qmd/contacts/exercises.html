<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Worked Solutions to the Exercises – EpiSim</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
MathJax = {
  loader: {
    load: ['[tex]/boldsymbol']
  },
  tex: {
    tags: "all",
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    packages: {
      '[+]': ['boldsymbol']
    }
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">EpiSim</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../instruction.html"> 
<span class="menu-text">Instruction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../simulation.html"> 
<span class="menu-text">Simulation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../likelihood.html"> 
<span class="menu-text">Likelihood</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../iterated.html"> 
<span class="menu-text">Maximum likelihood estimation and iterated filtering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../metapop.html"> 
<span class="menu-text">Meta population modelling</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exercise-8.1" id="toc-exercise-8.1" class="nav-link active" data-scroll-target="#exercise-8.1">Exercise 8.1</a></li>
  <li><a href="#exercise-8.2" id="toc-exercise-8.2" class="nav-link" data-scroll-target="#exercise-8.2">Exercise 8.2</a></li>
  <li><a href="#exercise-8.3" id="toc-exercise-8.3" class="nav-link" data-scroll-target="#exercise-8.3">Exercise 8.3</a></li>
  <li><a href="#exercise-8.4" id="toc-exercise-8.4" class="nav-link" data-scroll-target="#exercise-8.4">Exercise 8.4</a>
  <ul class="collapse">
  <li><a href="#some-notation-for-a-more-formal-investigation" id="toc-some-notation-for-a-more-formal-investigation" class="nav-link" data-scroll-target="#some-notation-for-a-more-formal-investigation">Some notation for a more formal investigation</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Worked Solutions to the Exercises</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<hr>
<section id="exercise-8.1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8.1">Exercise 8.1</h2>
<p>A PanelPOMP model with all parameters unit-specific is identical to a collection of independent POMP models. There may not be anything to be gained by using the PanelPOMP framework in this case, except perhaps that the <strong>panelPomp</strong> package can help with the book-keeping for working with the collection of panels.</p>
<p>One can expect an overhead from using <strong>panelPomp</strong> software when the simpler <strong>pomp</strong> software is sufficient.</p>
<p>PanelPOMP models with all unit-specific parameters can be used to test <strong>panelPomp</strong> methodology against <strong>pomp</strong> methodology since the latter also applies in this special case.</p>
<hr>
</section>
<section id="exercise-8.2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8.2">Exercise 8.2</h2>
<p>We can first check the list of help topics:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="at">help=</span>panelPomp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>as                      Coercing 'panelPomp' objects as 'list',
                        'pompList' or 'data.frame'
contacts                Contacts model
get_dim                 Get single column or row without dropping names
mif2                    PIF: Panel iterated filtering
panelGompertz           Panel Gompertz model
panelGompertzLikelihood
                        Likelihood for a panel Gompertz model via a
                        Kalman filter
panelPomp               Constructing 'panelPomp' objects
panelPomp-package       Inference for PanelPOMPs (Panel Partially
                        Observed Markov Processes)
panelPomp_methods       Manipulating 'panelPomp' objects
panelRandomWalk         Panel random walk model
panel_loglik            Handling of loglikelihood replicates
panel_logmeanexp        Log-mean-exp for panels
params                  Convert to and from a 'panelPomp' object
                        'pParams' slot format and a one-row
                        'data.frame'
pfilter                 Particle filtering for panel data
plot                    panelPomp plotting facilities
simulate                Simulations of a panel of partially observed
                        Markov process</code></pre>
</div>
</div>
<p>And then check out the promising ones:</p>
<p><code>?panelPomp_methods</code></p>
<div class="cell" data-layout-align="center">
<style type="text/css">
.help {
    text-align: left;
    border-width: 2px;
    width: 90%;
    height: 50ex;
    padding-left: 10px;
    padding-right: 10px;
    padding-top: 10px;
    padding-bottom: 20px;
}
</style>
</div>
<iframe id="panelPomp_methods" class="help" src="data:text/html;base64,PCFET0NUWVBFIGh0bWw+PGh0bWw+PGhlYWQ+PHRpdGxlPlI6IE1hbmlwdWxhdGluZyAncGFuZWxQb21wJyBvYmplY3RzPC90aXRsZT4KPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wLCB1c2VyLXNjYWxhYmxlPXllcyIgLz4KPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2thdGV4QDAuMTUuMy9kaXN0L2thdGV4Lm1pbi5jc3MiPgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+CmNvbnN0IG1hY3JvcyA9IHsgIlxcUiI6ICJcXHRleHRzZntSfSIsICJcXGNvZGUiOiAiXFx0ZXh0dHQifTsKZnVuY3Rpb24gcHJvY2Vzc01hdGhIVE1MKCkgewogICAgdmFyIGwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdyZXFuJyk7CiAgICBmb3IgKGxldCBlIG9mIGwpIHsga2F0ZXgucmVuZGVyKGUudGV4dENvbnRlbnQsIGUsIHsgdGhyb3dPbkVycm9yOiBmYWxzZSwgbWFjcm9zIH0pOyB9CiAgICByZXR1cm47Cn08L3NjcmlwdD4KPHNjcmlwdCBkZWZlciBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0va2F0ZXhAMC4xNS4zL2Rpc3Qva2F0ZXgubWluLmpzIgogICAgb25sb2FkPSJwcm9jZXNzTWF0aEhUTUwoKTsiPjwvc2NyaXB0Pgo8bGluayByZWw9InN0eWxlc2hlZXQiIHR5cGU9InRleHQvY3NzIiBocmVmPSJodHRwczovL2NyYW4uci1wcm9qZWN0Lm9yZy9SLmNzcyIgLz4KPC9oZWFkPjxib2R5PjxkaXYgY2xhc3M9ImNvbnRhaW5lciI+PG1haW4+Cgo8dGFibGUgc3R5bGU9IndpZHRoOiAxMDAlOyI+PHRyPjx0ZD5wYW5lbFBvbXBfbWV0aG9kczwvdGQ+PHRkIHN0eWxlPSJ0ZXh0LWFsaWduOiByaWdodDsiPlIgRG9jdW1lbnRhdGlvbjwvdGQ+PC90cj48L3RhYmxlPgoKPGgyPk1hbmlwdWxhdGluZyA8Y29kZT5wYW5lbFBvbXA8L2NvZGU+IG9iamVjdHM8L2gyPgoKPGgzPkRlc2NyaXB0aW9uPC9oMz4KCjxwPlRvb2xzIGZvciBtYW5pcHVsYXRpbmcgPGNvZGU+cGFuZWxQb21wPC9jb2RlPiBvYmplY3RzLgo8L3A+CgoKPGgzPlVzYWdlPC9oMz4KCjxwcmU+PGNvZGUgY2xhc3M9J2xhbmd1YWdlLVInPiMjIFM0IG1ldGhvZCBmb3Igc2lnbmF0dXJlICdwYW5lbFBvbXAnCmNvZWYob2JqZWN0KQoKIyMgUzQgcmVwbGFjZW1lbnQgbWV0aG9kIGZvciBzaWduYXR1cmUgJ3BhbmVsUG9tcCcKY29lZihvYmplY3QsIC4uLikgJmx0Oy0gdmFsdWUKCiMjIFM0IG1ldGhvZCBmb3Igc2lnbmF0dXJlICdwYW5lbFBvbXAnCmxlbmd0aCh4KQoKIyMgUzQgbWV0aG9kIGZvciBzaWduYXR1cmUgJ3BhbmVsUG9tcCcKbmFtZXMoeCkKCiMjIFM0IG1ldGhvZCBmb3Igc2lnbmF0dXJlICdwYW5lbFBvbXAnCnBwYXJhbXMob2JqZWN0KQoKcFBhcmFtcyh2YWx1ZSkKCiMjIFM0IG1ldGhvZCBmb3Igc2lnbmF0dXJlICdwYW5lbFBvbXAnCnByaW50KHgsIC4uLikKCiMjIFM0IG1ldGhvZCBmb3Igc2lnbmF0dXJlICdwYW5lbFBvbXAnCnNob3cob2JqZWN0KQoKIyMgUzQgbWV0aG9kIGZvciBzaWduYXR1cmUgJ3BhbmVsUG9tcCcKdW5pdG9iamVjdHMob2JqZWN0KQoKIyMgUzQgbWV0aG9kIGZvciBzaWduYXR1cmUgJ3BhbmVsUG9tcCcKd2luZG93KHgsIHN0YXJ0LCBlbmQpCgojIyBTNCBtZXRob2QgZm9yIHNpZ25hdHVyZSAncGFuZWxQb21wJwp4W2ldCgojIyBTNCBtZXRob2QgZm9yIHNpZ25hdHVyZSAncGFuZWxQb21wJwp4W1tpXV0KPC9jb2RlPjwvcHJlPgoKCjxoMz5Bcmd1bWVudHM8L2gzPgoKPHRhYmxlPgo8dHI+PHRkPjxjb2RlIGlkPSJvYmplY3QiPm9iamVjdDwvY29kZT4sIDxjb2RlIGlkPSJ4Ij54PC9jb2RlPjwvdGQ+Cjx0ZD4KPHA+QW4gb2JqZWN0IG9mIGNsYXNzIDxjb2RlPnBhbmVsUG9tcDwvY29kZT4gb3IgaW5oZXJpdGluZyBjbGFzcwo8Y29kZT5wYW5lbFBvbXA8L2NvZGU+LjwvcD4KPC90ZD48L3RyPgo8dHI+PHRkPjxjb2RlIGlkPSIuLi4iPi4uLjwvY29kZT48L3RkPgo8dGQ+CjxwPi4uLi48L3A+CjwvdGQ+PC90cj4KPHRyPjx0ZD48Y29kZSBpZD0idmFsdWUiPnZhbHVlPC9jb2RlPjwvdGQ+Cjx0ZD4KPHA+dmFsdWUgdG8gYmUgYXNzaWduZWQuPC9wPgo8L3RkPjwvdHI+Cjx0cj48dGQ+PGNvZGUgaWQ9InN0YXJ0Ij5zdGFydDwvY29kZT4sIDxjb2RlIGlkPSJlbmQiPmVuZDwvY29kZT48L3RkPgo8dGQ+CjxwPnBvc2l0aW9uIGluIG9yaWdpbmFsIDxjb2RlPnRpbWVzKHBvbXApPC9jb2RlPiBhdCB3aGljaCB0byBzdGFydC48L3A+CjwvdGQ+PC90cj4KPHRyPjx0ZD48Y29kZSBpZD0iaSI+aTwvY29kZT48L3RkPgo8dGQ+CjxwPnVuaXQgaW5kZXggKGluZGljZXMpIG9yIG5hbWUgKG5hbWVzKS48L3A+CjwvdGQ+PC90cj4KPC90YWJsZT4KCgo8aDM+VmFsdWU8L2gzPgoKPHA+PGNvZGU+Y29lZigpPC9jb2RlPiByZXR1cm5zIGEgPGNvZGU+bnVtZXJpYzwvY29kZT4gdmVjdG9yLgo8L3A+CjxwPjxjb2RlPmxlbmd0aCgpPC9jb2RlPiByZXR1cm5zIGFuIDxjb2RlPmludGVnZXI8L2NvZGU+Lgo8L3A+CjxwPjxjb2RlPm5hbWVzKCk8L2NvZGU+IHJldHVybnMgYSA8Y29kZT5jaGFyYWN0ZXI8L2NvZGU+IHZlY3Rvci4KPC9wPgo8cD5XaGVuIGdpdmVuIG9iamVjdHMgb2YgY2xhc3MgPGNvZGU+cGFuZWxQb21wPC9jb2RlPiwgPGNvZGU+cHBhcmFtcygpPC9jb2RlPiByZXR1cm5zIGEgbmFtZWQgbGlzdCB3aXRoIHR3byBlbGVtZW50czogPGNvZGU+c2hhcmVkPC9jb2RlPiwgd2hpY2ggaXMgYSBuYW1lZCA8Y29kZT5udW1lcmljPC9jb2RlPiB2ZWN0b3IsIGFuZCA8Y29kZT5zcGVjaWZpYzwvY29kZT4sIHdoaWNoIGlzIGEgPGNvZGU+bWF0cml4PC9jb2RlPiB3aXRoIHBhcmFtZXRlciBuYW1lcyBpbiBpdHMgcm93IG5hbWVzIGFuZCBwYW5lbCB1bml0IG5hbWVzIGluIGl0cyBjb2x1bW4gbmFtZXMuCjwvcD4KPHA+PGNvZGU+cFBhcmFtcygpPC9jb2RlPiByZXR1cm5zIGEgPGNvZGU+bGlzdDwvY29kZT4gd2l0aCB0aGUgbW9kZWwgcGFyYW1ldGVycyBpbiBsaXN0IGZvcm0uCjwvcD4KPHA+V2hlbiBnaXZlbiBvYmplY3RzIG9mIGNsYXNzIDxjb2RlPnBhbmVsUG9tcDwvY29kZT4sIDxjb2RlPnVuaXRvYmplY3RzKCk8L2NvZGU+IHJldHVybnMgYSA8Y29kZT5saXN0PC9jb2RlPiBvZiA8Y29kZT5wb21wPC9jb2RlPiBvYmplY3RzLgo8L3A+CjxwPjxjb2RlPndpbmRvdygpPC9jb2RlPiByZXR1cm5zIGEgPGNvZGU+cGFuZWxQb21wPC9jb2RlPiBvYmplY3Qgd2l0aCBhZGp1c3RlZCB0aW1lcy4KPC9wPgo8cD48Y29kZT5gW2A8L2NvZGU+IHJldHVybnMgYSA8Y29kZT5wYW5lbFBvbXA8L2NvZGU+IG9iamVjdC4KPC9wPgo8cD48Y29kZT5gW1tgPC9jb2RlPiByZXR1cm5zIGEgPGNvZGU+cG9tcDwvY29kZT4gb2JqZWN0Lgo8L3A+CgoKPGgzPk1ldGhvZHM8L2gzPgoKCjxkbD4KPGR0PmNvZWY8L2R0PjxkZD48cD5FeHRyYWN0cyBjb2VmZmljaWVudHMgb2YgPGNvZGU+cGFuZWxQb21wPC9jb2RlPiBvYmplY3RzLjwvcD4KPC9kZD4KPGR0PmNvZWYmbHQ7LTwvZHQ+PGRkPjxwPkFzc2lnbiBjb2VmZmljaWVudHMgdG8gPGNvZGU+cGFuZWxQb21wPC9jb2RlPiBvYmplY3RzLjwvcD4KPC9kZD4KPGR0Pmxlbmd0aDwvZHQ+PGRkPjxwPkNvdW50IHRoZSBudW1iZXIgb2YgdW5pdHMgaW4gPGNvZGU+cGFuZWxQb21wPC9jb2RlPiBvYmplY3RzLjwvcD4KPC9kZD4KPGR0Pm5hbWVzPC9kdD48ZGQ+PHA+R2V0IHRoZSB1bml0IG5hbWVzIG9mIDxjb2RlPnBhbmVsUG9tcDwvY29kZT4gb2JqZWN0cy48L3A+CjwvZGQ+CjxkdD5wcGFyYW1zPC9kdD48ZGQ+PHA+RXh0cmFjdHMgY29lZmZpY2llbnRzIGZyb20gPGNvZGU+cGFuZWxQb21wPC9jb2RlPiBvYmplY3RzIGluIGxpc3QgZm9ybS48L3A+CjwvZGQ+CjxkdD5wUGFyYW1zPC9kdD48ZGQ+PHA+Q29udmVydHMgcGFuZWwgY29lZmZpY2llbnRzIGZyb20gdmVjdG9yIGZvcm0gdG8gbGlzdCBmb3JtLjwvcD4KPC9kZD4KPGR0PndpbmRvdzwvZHQ+PGRkPjxwPlN1YnNldCA8Y29kZT5wYW5lbFBvbXA8L2NvZGU+IG9iamVjdHMgYnkgY2hhbmdpbmcgc3RhcnQgdGltZSBhbmQKZW5kIHRpbWUuPC9wPgo8L2RkPgo8ZHQ+PGNvZGU+W108L2NvZGU+PC9kdD48ZGQ+PHA+VGFrZSBhIHN1YnNldCBvZiB1bml0cy48L3A+CjwvZGQ+CjxkdD48Y29kZT5bW11dPC9jb2RlPjwvZHQ+PGRkPjxwPlNlbGVjdCB0aGUgcG9tcCBvYmplY3QgZm9yIGEgc2luZ2xlIHVuaXQuPC9wPgo8L2RkPgo8L2RsPgoKCgo8aDM+QXV0aG9yKHMpPC9oMz4KCjxwPkNhcmxlcyBCcmV0Jm9hY3V0ZTssIEFhcm9uIEEuIEtpbmcuCjwvcD4KCgo8aDM+U2VlIEFsc288L2gzPgoKPHA+T3RoZXIgcGFuZWxQb21wIG1ldGhvZHM6IAo8Y29kZT5hcygpPC9jb2RlPgo8L3A+CgoKPGgzPkV4YW1wbGVzPC9oMz4KCjxwcmU+PGNvZGUgY2xhc3M9J2xhbmd1YWdlLVInPiMjIGFjY2VzcyBhbmQgbWFuaXB1bGF0ZSBtb2RlbCBwYXJhbWV0ZXJzIGFuZCBvdGhlciBmZWF0dXJlcwpwcncgJmx0Oy0gcGFuZWxSYW5kb21XYWxrKCkKY29lZihwcncpCiMgcmVwbGFjZSBjb2VmZmljaWVudHMKY29lZihwcncpICZsdDstIGMoc2lnbWFYPTIsY29lZihwcncpWy0xXSkKY29lZihwcncpCmxlbmd0aChwcncpCm5hbWVzKHBydykKIyBleHRyYWN0IHBhcmFtZXRlcnMgaW4gbGlzdCBmb3JtCnBwYXJhbXMocHJ3KQojIGNvbnZlcnQgdmVjdG9yLWZvcm0gcGFyYW1ldGVycyB0byBsaXN0LWZvcm0gcGFyYW1ldGVycwpwUGFyYW1zKGNvZWYocHJ3KSkKIyMgc3VtbWFyaWVzIG9mIG9iamVjdHMKcHJpbnQocHJ3KQpzaG93KHBydykKIyMgYWNjZXNzIHVuZGVybHlpbmcgcG9tcCBvYmplY3RzCnVuaXRvYmplY3RzKHBydykKIyMgc2VsZWN0IHdpbmRvd3Mgb2YgdGltZQp3aW5kb3cocHJ3LHN0YXJ0PTIsZW5kPTQpCiMjIHN1YnNldHRpbmcgcGFuZWxQb21wIG9iamVjdHMKcHJ3WzFdICMgcGFuZWxQb21wIG9mIDEgdW5pdCAoZmlyc3QgdW5pdCBvZiBwcncpCnByd1tbMl1dICMgcG9tcCBvYmplY3QgY29ycmVzcG9uZGluZyB0byB1bml0IDIgb2YgcHJ3CjwvY29kZT48L3ByZT4KCjwvbWFpbj4KCjwvZGl2Pgo8L2JvZHk+PC9odG1sPgo=">
</iframe>
<hr>
</section>
<section id="exercise-8.3" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8.3">Exercise 8.3</h2>
<ul>
<li><p>Since a PanelPOMP is a collection of independent POMP models, they can each be filtered separately.</p></li>
<li><p>The <code>pfilter</code> method for class <code>panelPomp</code> does exactly this, after extracting the parameter vector for each unit from the shared and unit-specific parameters belonging to the <code>panelPomp</code> object.</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>contacts <span class="ot">&lt;-</span> <span class="fu">contacts</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pf <span class="ot">&lt;-</span> <span class="fu">pfilter</span>(contacts,<span class="at">Np=</span><span class="dv">100</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "pfilterd.ppomp"
attr(,"package")
[1] "panelPomp"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(<span class="fu">unitobjects</span>(pf)[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "pfilterd_pomp"
attr(,"package")
[1] "pomp"</code></pre>
</div>
</div>
<hr>
</section>
<section id="exercise-8.4" class="level2">
<h2 class="anchored" data-anchor-id="exercise-8.4">Exercise 8.4</h2>
<ul>
<li><p>It turns out that the SMC algorithm implemented by <code>pfilter()</code> gives an unbiased Monte Carlo estimate of the likelihood.</p></li>
<li><p>For inferential purposes, we usually work with the log likelihood.</p></li>
<li><p>Due to Jensen’s inequality, SMC has a negative bias as an estimator of the log likelihood, i.e., it systematically underestimates the log likelihood.</p></li>
<li><p>Usually, the higher the Monte Carlo variance on the likelihood, the larger this bias.</p></li>
<li><p>Thus, lower Monte Carlo variance on the log likelihood is commonly associated with higher estimated log likelihood.</p></li>
<li><p>Heuristically, products propagate error rapidly. Averaging Monte Carlo replicates over units before taking a product reduces this error propagation. It does not lead to bias in the likelihood estimate since independence over units and Monte Carlo replicates insures that the expected product of the averages is the expected average of the products.</p></li>
</ul>
<section id="some-notation-for-a-more-formal-investigation" class="level3">
<h3 class="anchored" data-anchor-id="some-notation-for-a-more-formal-investigation">Some notation for a more formal investigation</h3>
<ul>
<li><p>Let <span class="math inline">\(\hat\lambda_u^{(k)}\)</span> be the <span class="math inline">\(k\)</span>th replication of the Monte Carlo log likelihood evaluation for unit <span class="math inline">\(u\)</span>.</p></li>
<li><p>Let <span class="math inline">\(\hat L_u^{(k)}=\exp\big\{\hat\lambda_u^{(k)}\big\}\)</span> be the corresponding likelihood.</p></li>
<li><p>Let <span class="math inline">\(\hat\lambda^{(k)}=\sum_{u=1}^U \lambda_{u}^{(k)}\)</span> be an estimate the log likelihood of the entire data based on replication <span class="math inline">\(k\)</span>.</p></li>
<li><p>Let <span class="math inline">\(\hat L^{(k)}=\exp\big\{\hat\lambda^{(k)}\big\}\)</span> be the corresponding estimate of the likelihood.</p></li>
<li><p>Different possible estimates of the actual log likelihood <span class="math inline">\(\lambda=\sum_{u=1}^U \lambda_u\)</span> are</p></li>
</ul>
<p><span class="math display">\[\begin{eqnarray} \hat\lambda^{[1]} &amp;=&amp; \frac{1}{K}\sum_{k=1}^K \hat\lambda^{(k)}
\\
  \hat\lambda^{[2]} &amp;=&amp; \log \left( \frac{1}{K}\sum_{k=1}^K
  \exp \big\{\hat \lambda^{(k)} \big\} \right)  
\\
\hat\lambda^{[3]} &amp;=&amp; \sum_{u=1}^U\frac{1}{K}\sum_{k=1}^K \hat\lambda^{(k)}_u  
\\
  \hat\lambda^{[4]} &amp;=&amp; \sum_{u=1}^U \log \left( \frac{1}{K}\sum_{k=1}^K \exp\big\{\hat \lambda^{(k)}_u \big\} \right)  
\end{eqnarray}\]</span></p>
<ol type="a">
<li>Check that <span class="math inline">\(\hat\lambda^{[1]}\)</span> and <span class="math inline">\(\hat\lambda^{[3]}\)</span> are equal. However, they are inconsistent, since <span class="math inline">\(\hat\lambda^{(k)}_u\)</span> is a biased estimate of <span class="math inline">\(\lambda_u\)</span> and the bias does not disappear when we take an average over replicates.</li>
<li><span class="math inline">\(\hat\lambda^{[2]}\)</span> is the log mean exp of the total log likelihood for all units.</li>
<li><span class="math inline">\(\hat\lambda^{[4]}\)</span> is the sum of the log mean exp for each unit separately.</li>
</ol>
<ul>
<li>To compare variances, it is convenient to move back to the likelihood scale:</li>
</ul>
<p><span class="math display">\[\begin{eqnarray}
  \hat L^{[2]} &amp;=&amp; \frac{1}{K}\sum_{k=1}^K \prod_{u=1}^U L^{(k)}
\\
  \hat L^{[4]} &amp;=&amp; \prod_{u=1}^U \frac{1}{K}\sum_{k=1}^K \hat L^{(k)}_u  
\end{eqnarray}\]</span></p>
<ul>
<li><p><span class="citation" data-cites="Breto2020">Bretó, Ionides, and King (<a href="#ref-Breto2020" role="doc-biblioref">2020</a>)</span> showed that <span class="math inline">\(\hat L^{[4]}\)</span> is smaller than <span class="math inline">\(\hat L^{[2]}\)</span>.</p></li>
<li><p>In a limit where <span class="math inline">\(U\)</span> and <span class="math inline">\(K\)</span> both grow together, <span class="math inline">\(\hat L^{[4]}\)</span> can be stable while <span class="math inline">\(\hat L^{[2]}\)</span> increases to infinity.</p></li>
</ul>
<hr>
<p>Produced with <strong>R</strong> version 4.4.0, <strong>pomp</strong> version 5.9, and <strong>panelPomp</strong> version 1.1.0.1.</p>
<hr>
</section>
</section>
<section id="references" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Breto2020" class="csl-entry" role="listitem">
Bretó C, Ionides EL, King AA (2020). <span>“Panel Data Analysis via Mechanistic Models.”</span> <em>J Am Stat Assoc</em>, <strong>115</strong>(531), pre–published online. <a href="https://doi.org/10.1080/01621459.2019.1604367">https://doi.org/10.1080/01621459.2019.1604367.</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>